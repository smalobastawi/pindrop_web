import{r,b as N,s as T,e as d,f as s,h as f,H as g,F as j,I as z,J as c,L as m,j as p,Q as b,i as t,w as e,g as E,R as H,K as A,M as h,u as J,o as u}from"./vendor-CVqOb0XR.js";import{_ as K,u as Q,a as M}from"./index-Ba6kPx5P.js";const G={name:"AdminLayout",setup(){const y=J(),n=Q(),v=r(!1),o=r(!1),k=r(!1),C=r(!1),l=r([]),a=r(0),x=r({}),P=r(!1),S=r({main:!1,management:!1,analytics:!1,administration:!1,system:!1}),w=r({current_password:"",new_password:"",confirm_password:""}),F=N(()=>n.hasPermission("manage_users")),_=N(()=>n.hasPermission("manage_settings")),D=()=>{v.value=!v.value,localStorage.setItem("admin_sidebar_collapsed",v.value)},L=i=>{S.value[i]=!S.value[i]},V=()=>{k.value=!1,y.push("/admin/profile")},R=async()=>{try{await n.logout(),y.push("/login")}catch(i){console.error("Logout error:",i)}},U=async()=>{if(w.value.new_password!==w.value.confirm_password){alert("New passwords do not match");return}P.value=!0;try{await n.changePassword(w.value),C.value=!1,w.value={current_password:"",new_password:"",confirm_password:""},alert("Password changed successfully")}catch(i){alert("Failed to change password: "+i.message)}finally{P.value=!1}},B=i=>new Date(i).toLocaleString(),I=async()=>{try{const i=await M.get("/admin-api/api/dashboard/recent-activities/?limit=5");l.value=i.data.activities||[],a.value=l.value.length}catch(i){console.error("Failed to load notifications:",i)}},q=async()=>{try{const i=await M.get("/admin-api/api/users/me/");x.value=i.data}catch(i){console.error("Failed to load admin profile:",i)}};return T(()=>{v.value=localStorage.getItem("admin_sidebar_collapsed")==="true",I(),q()}),{sidebarCollapsed:v,showNotifications:o,showProfileMenu:k,showChangePassword:C,notifications:l,unreadNotifications:a,adminProfile:x,passwordForm:w,changingPassword:P,canManageUsers:F,canManageSettings:_,toggleSidebar:D,toggleSection:L,expandedSections:S,viewProfile:V,logout:R,changePassword:U,formatDate:B}}},O={class:"admin-layout"},W={class:"admin-header"},X={class:"header-content"},Y={class:"header-actions"},Z={class:"notifications"},$={key:0,class:"notification-badge"},ss={key:0,class:"notification-dropdown"},ns={class:"notification-list"},os={class:"admin-profile"},as=["src"],ls={key:0,class:"profile-dropdown"},is={class:"admin-body"},ts={class:"sidebar-nav"},es={class:"nav-section"},rs={class:"nav-section"},ds={class:"nav-section"},us={key:0,class:"nav-section"},ms={key:1,class:"nav-section"},cs={class:"admin-main"},vs={class:"main-content"},fs={class:"modal-header"},ws={class:"modal-body"},gs={class:"form-group"},ps={class:"form-group"},bs={class:"form-group"},ys={class:"modal-actions"},ks=["disabled"];function Cs(y,n,v,o,k,C){const l=E("router-link");return u(),d("div",O,[s("header",W,[s("div",X,[n[23]||(n[23]=s("div",{class:"logo"},[s("h1",null,"RiderApp Admin")],-1)),s("div",Y,[s("div",Z,[s("button",{class:"notification-btn",onClick:n[0]||(n[0]=a=>o.showNotifications=!o.showNotifications)},[n[19]||(n[19]=s("i",{class:"icon-bell"},null,-1)),o.unreadNotifications>0?(u(),d("span",$,g(o.unreadNotifications),1)):f("",!0)]),o.showNotifications?(u(),d("div",ss,[n[20]||(n[20]=s("h4",null,"Notifications",-1)),s("div",ns,[(u(!0),d(j,null,z(o.notifications,a=>(u(),d("div",{key:a.id,class:"notification-item"},[s("p",null,g(a.message),1),s("small",null,g(o.formatDate(a.created_at)),1)]))),128))])])):f("",!0)]),s("div",os,[s("button",{class:"profile-btn",onClick:n[1]||(n[1]=a=>o.showProfileMenu=!o.showProfileMenu)},[s("img",{src:o.adminProfile.avatar||"/default-avatar.png",alt:"Profile",class:"avatar"},null,8,as),s("span",null,g(o.adminProfile.name||"Admin User"),1),n[21]||(n[21]=s("i",{class:"icon-chevron-down"},null,-1))]),o.showProfileMenu?(u(),d("div",ls,[s("a",{href:"#",onClick:n[2]||(n[2]=(...a)=>o.viewProfile&&o.viewProfile(...a))},"View Profile"),s("a",{href:"#",onClick:n[3]||(n[3]=a=>o.showChangePassword=!0)},"Change Password"),n[22]||(n[22]=s("hr",null,null,-1)),s("a",{href:"#",onClick:n[4]||(n[4]=(...a)=>o.logout&&o.logout(...a))},"Logout")])):f("",!0)])])])]),s("div",is,[s("aside",{class:c(["admin-sidebar",{"sidebar-collapsed":o.sidebarCollapsed}])},[s("nav",ts,[s("div",es,[s("h3",{onClick:n[5]||(n[5]=a=>o.toggleSection("main"))},[n[24]||(n[24]=p("Dashboard ",-1)),s("i",{class:c(["icon-chevron-down",{rotated:!o.expandedSections.main}])},null,2)]),m(s("ul",null,[s("li",null,[t(l,{to:"/admin",class:"nav-link"},{default:e(()=>[...n[25]||(n[25]=[s("i",{class:"icon-dashboard"},null,-1),s("span",null,"Dashboard",-1)])]),_:1})])],512),[[b,o.expandedSections.main]])]),s("div",rs,[s("h3",{onClick:n[6]||(n[6]=a=>o.toggleSection("management"))},[n[26]||(n[26]=p("Management ",-1)),s("i",{class:c(["icon-chevron-down",{rotated:!o.expandedSections.management}])},null,2)]),m(s("ul",null,[s("li",null,[t(l,{to:"/admin/customers",class:"nav-link"},{default:e(()=>[...n[27]||(n[27]=[s("i",{class:"icon-users"},null,-1),s("span",null,"Customers",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/drivers",class:"nav-link"},{default:e(()=>[...n[28]||(n[28]=[s("i",{class:"icon-truck"},null,-1),s("span",null,"Drivers/Riders",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/deliveries",class:"nav-link"},{default:e(()=>[...n[29]||(n[29]=[s("i",{class:"icon-package"},null,-1),s("span",null,"Deliveries",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/routes",class:"nav-link"},{default:e(()=>[...n[30]||(n[30]=[s("i",{class:"icon-map"},null,-1),s("span",null,"Routes",-1)])]),_:1})])],512),[[b,o.expandedSections.management]])]),s("div",ds,[s("h3",{onClick:n[7]||(n[7]=a=>o.toggleSection("analytics"))},[n[31]||(n[31]=p("Analytics ",-1)),s("i",{class:c(["icon-chevron-down",{rotated:!o.expandedSections.analytics}])},null,2)]),m(s("ul",null,[s("li",null,[t(l,{to:"/admin/reports",class:"nav-link"},{default:e(()=>[...n[32]||(n[32]=[s("i",{class:"icon-bar-chart"},null,-1),s("span",null,"Reports",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/audit-logs",class:"nav-link"},{default:e(()=>[...n[33]||(n[33]=[s("i",{class:"icon-activity"},null,-1),s("span",null,"Audit Logs",-1)])]),_:1})])],512),[[b,o.expandedSections.analytics]])]),o.canManageUsers?(u(),d("div",us,[s("h3",{onClick:n[8]||(n[8]=a=>o.toggleSection("administration"))},[n[34]||(n[34]=p("Administration ",-1)),s("i",{class:c(["icon-chevron-down",{rotated:!o.expandedSections.administration}])},null,2)]),m(s("ul",null,[s("li",null,[t(l,{to:"/admin/users",class:"nav-link"},{default:e(()=>[...n[35]||(n[35]=[s("i",{class:"icon-user-cog"},null,-1),s("span",null,"Users",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/roles",class:"nav-link"},{default:e(()=>[...n[36]||(n[36]=[s("i",{class:"icon-shield"},null,-1),s("span",null,"Roles & Permissions",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/settings",class:"nav-link"},{default:e(()=>[...n[37]||(n[37]=[s("i",{class:"icon-settings"},null,-1),s("span",null,"System Settings",-1)])]),_:1})])],512),[[b,o.expandedSections.administration]])])):f("",!0),o.canManageSettings?(u(),d("div",ms,[s("h3",{onClick:n[9]||(n[9]=a=>o.toggleSection("system"))},[n[38]||(n[38]=p("System ",-1)),s("i",{class:c(["icon-chevron-down",{rotated:!o.expandedSections.system}])},null,2)]),m(s("ul",null,[s("li",null,[t(l,{to:"/admin/templates",class:"nav-link"},{default:e(()=>[...n[39]||(n[39]=[s("i",{class:"icon-mail"},null,-1),s("span",null,"Templates",-1)])]),_:1})]),s("li",null,[t(l,{to:"/admin/backup",class:"nav-link"},{default:e(()=>[...n[40]||(n[40]=[s("i",{class:"icon-database"},null,-1),s("span",null,"Backup",-1)])]),_:1})])],512),[[b,o.expandedSections.system]])])):f("",!0)]),s("button",{class:"sidebar-toggle",onClick:n[10]||(n[10]=(...a)=>o.toggleSidebar&&o.toggleSidebar(...a))},[s("i",{class:c(o.sidebarCollapsed?"icon-chevron-right":"icon-chevron-left")},null,2)])],2),s("main",cs,[s("div",vs,[H(y.$slots,"default",{},void 0)])])]),o.showChangePassword?(u(),d("div",{key:0,class:"modal-overlay",onClick:n[18]||(n[18]=a=>o.showChangePassword=!1)},[s("div",{class:"modal",onClick:n[17]||(n[17]=A(()=>{},["stop"]))},[s("div",fs,[n[41]||(n[41]=s("h3",null,"Change Password",-1)),s("button",{onClick:n[11]||(n[11]=a=>o.showChangePassword=!1),class:"close-btn"},"Ã—")]),s("div",ws,[s("form",{onSubmit:n[16]||(n[16]=A((...a)=>o.changePassword&&o.changePassword(...a),["prevent"]))},[s("div",gs,[n[42]||(n[42]=s("label",{for:"current-password"},"Current Password",-1)),m(s("input",{type:"password",id:"current-password","onUpdate:modelValue":n[12]||(n[12]=a=>o.passwordForm.current_password=a),required:""},null,512),[[h,o.passwordForm.current_password]])]),s("div",ps,[n[43]||(n[43]=s("label",{for:"new-password"},"New Password",-1)),m(s("input",{type:"password",id:"new-password","onUpdate:modelValue":n[13]||(n[13]=a=>o.passwordForm.new_password=a),required:""},null,512),[[h,o.passwordForm.new_password]])]),s("div",bs,[n[44]||(n[44]=s("label",{for:"confirm-password"},"Confirm New Password",-1)),m(s("input",{type:"password",id:"confirm-password","onUpdate:modelValue":n[14]||(n[14]=a=>o.passwordForm.confirm_password=a),required:""},null,512),[[h,o.passwordForm.confirm_password]])]),s("div",ys,[s("button",{type:"button",onClick:n[15]||(n[15]=a=>o.showChangePassword=!1),class:"btn btn-secondary"}," Cancel "),s("button",{type:"submit",class:"btn btn-primary",disabled:o.changingPassword},g(o.changingPassword?"Changing...":"Change Password"),9,ks)])],32)])])])):f("",!0)])}const xs=K(G,[["render",Cs],["__scopeId","data-v-ce3cef43"]]);export{xs as A};
