import{r as d,b as V,L as O,s as j,e as v,f as e,D as r,C as N,E as u,k as _,G as y,I as h,M as D,i as A,J as E,o as m,j as B,w as nt,g as q,F as L,K as z}from"./vendor-CbvXNS-i.js";import{A as it}from"./AdminLayout-CM_OGgUk.js";import{_ as Q,a as S}from"./index--w8yyAH4.js";import{d as rt}from"./debounce-B9j8fP-T.js";import"./adminAuth-DjiH6aaA.js";import"./ui-D_DTyfBr.js";const at={name:"CustomerModal",props:{customer:{type:Object,default:null}},emits:["close","save"],setup(f,{emit:t}){const p=d(!1),o=d({}),c=d({name:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"",date_of_birth:"",customer_type:"individual",notes:"",is_active:!0}),b=V(()=>!!f.customer),l=()=>{c.value={name:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"",date_of_birth:"",customer_type:"individual",notes:"",is_active:!0},o.value={}},k=i=>{c.value={name:i.name||"",email:i.email||"",phone:i.phone||"",address:i.address||"",city:i.city||"",state:i.state||"",postal_code:i.postal_code||"",country:i.country||"",date_of_birth:i.date_of_birth||"",customer_type:i.customer_type||"individual",notes:i.notes||"",is_active:i.is_active!==void 0?i.is_active:!0}},s=()=>(o.value={},c.value.name.trim()||(o.value.name="Name is required"),c.value.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.value.email)||(o.value.email="Please enter a valid email address"):o.value.email="Email is required",c.value.phone.trim()||(o.value.phone="Phone number is required"),c.value.address.trim()||(o.value.address="Address is required"),Object.keys(o.value).length===0),g=async()=>{if(s()){p.value=!0;try{const i={...c.value};i.date_of_birth&&(i.date_of_birth=new Date(i.date_of_birth).toISOString().split("T")[0]),t("save",i)}catch(i){console.error("Form submission error:",i)}finally{p.value=!1}}};return O(()=>f.customer,i=>{i?k(i):l()},{immediate:!0}),j(()=>{f.customer&&k(f.customer)}),{form:c,errors:o,saving:p,isEdit:b,handleSubmit:g}}},dt={class:"modal-header"},ut={class:"modal-body"},mt={class:"form-grid"},ct={class:"form-section"},vt={class:"form-group"},ft={key:0,class:"error-text"},bt={class:"form-group"},gt={key:0,class:"error-text"},yt={class:"form-group"},pt={key:0,class:"error-text"},Ct={class:"form-section"},_t={class:"form-group"},kt={key:0,class:"error-text"},ht={class:"form-row"},wt={class:"form-group"},St={class:"form-group"},At={class:"form-row"},xt={class:"form-group"},Ft={class:"form-group"},Mt={class:"form-section"},Pt={class:"form-row"},Vt={class:"form-group"},Dt={class:"form-group"},Et={class:"form-group"},Ut={class:"form-group"},Tt={class:"checkbox-wrapper"},It={class:"modal-actions"},Nt=["disabled"],Bt={key:0,class:"loading-spinner"};function qt(f,t,p,o,c,b){return m(),v("div",{class:"modal-overlay",onClick:t[16]||(t[16]=l=>f.$emit("close"))},[e("div",{class:"modal",onClick:t[15]||(t[15]=N(()=>{},["stop"]))},[e("div",dt,[e("h3",null,r(o.isEdit?"Edit Customer":"Add New Customer"),1),e("button",{onClick:t[0]||(t[0]=l=>f.$emit("close")),class:"close-btn"},"Ã—")]),e("div",ut,[e("form",{onSubmit:t[14]||(t[14]=N((...l)=>o.handleSubmit&&o.handleSubmit(...l),["prevent"]))},[e("div",mt,[e("div",ct,[t[20]||(t[20]=e("h4",null,"Basic Information",-1)),e("div",vt,[t[17]||(t[17]=e("label",{for:"name"},"Full Name *",-1)),u(e("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=l=>o.form.name=l),type:"text",required:"",class:h({error:o.errors.name}),placeholder:"Enter customer's full name"},null,2),[[y,o.form.name]]),o.errors.name?(m(),v("div",ft,r(o.errors.name),1)):_("",!0)]),e("div",bt,[t[18]||(t[18]=e("label",{for:"email"},"Email Address *",-1)),u(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=l=>o.form.email=l),type:"email",required:"",class:h({error:o.errors.email}),placeholder:"Enter email address"},null,2),[[y,o.form.email]]),o.errors.email?(m(),v("div",gt,r(o.errors.email),1)):_("",!0)]),e("div",yt,[t[19]||(t[19]=e("label",{for:"phone"},"Phone Number *",-1)),u(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=l=>o.form.phone=l),type:"tel",required:"",class:h({error:o.errors.phone}),placeholder:"Enter phone number"},null,2),[[y,o.form.phone]]),o.errors.phone?(m(),v("div",pt,r(o.errors.phone),1)):_("",!0)])]),e("div",Ct,[t[26]||(t[26]=e("h4",null,"Address Information",-1)),e("div",_t,[t[21]||(t[21]=e("label",{for:"address"},"Street Address *",-1)),u(e("textarea",{id:"address","onUpdate:modelValue":t[4]||(t[4]=l=>o.form.address=l),required:"",class:h({error:o.errors.address}),rows:"3",placeholder:"Enter street address"},null,2),[[y,o.form.address]]),o.errors.address?(m(),v("div",kt,r(o.errors.address),1)):_("",!0)]),e("div",ht,[e("div",wt,[t[22]||(t[22]=e("label",{for:"city"},"City",-1)),u(e("input",{id:"city","onUpdate:modelValue":t[5]||(t[5]=l=>o.form.city=l),type:"text",placeholder:"Enter city"},null,512),[[y,o.form.city]])]),e("div",St,[t[23]||(t[23]=e("label",{for:"state"},"State/Province",-1)),u(e("input",{id:"state","onUpdate:modelValue":t[6]||(t[6]=l=>o.form.state=l),type:"text",placeholder:"Enter state"},null,512),[[y,o.form.state]])])]),e("div",At,[e("div",xt,[t[24]||(t[24]=e("label",{for:"postal_code"},"Postal Code",-1)),u(e("input",{id:"postal_code","onUpdate:modelValue":t[7]||(t[7]=l=>o.form.postal_code=l),type:"text",placeholder:"Enter postal code"},null,512),[[y,o.form.postal_code]])]),e("div",Ft,[t[25]||(t[25]=e("label",{for:"country"},"Country",-1)),u(e("input",{id:"country","onUpdate:modelValue":t[8]||(t[8]=l=>o.form.country=l),type:"text",placeholder:"Enter country"},null,512),[[y,o.form.country]])])])])]),e("div",Mt,[t[33]||(t[33]=e("h4",null,"Additional Information",-1)),e("div",Pt,[e("div",Vt,[t[27]||(t[27]=e("label",{for:"date_of_birth"},"Date of Birth",-1)),u(e("input",{id:"date_of_birth","onUpdate:modelValue":t[9]||(t[9]=l=>o.form.date_of_birth=l),type:"date"},null,512),[[y,o.form.date_of_birth]])]),e("div",Dt,[t[29]||(t[29]=e("label",{for:"customer_type"},"Customer Type",-1)),u(e("select",{id:"customer_type","onUpdate:modelValue":t[10]||(t[10]=l=>o.form.customer_type=l)},[...t[28]||(t[28]=[e("option",{value:"individual"},"Individual",-1),e("option",{value:"business"},"Business",-1),e("option",{value:"vip"},"VIP",-1)])],512),[[D,o.form.customer_type]])])]),e("div",Et,[t[30]||(t[30]=e("label",{for:"notes"},"Notes",-1)),u(e("textarea",{id:"notes","onUpdate:modelValue":t[11]||(t[11]=l=>o.form.notes=l),rows:"3",placeholder:"Additional notes about the customer"},null,512),[[y,o.form.notes]])]),e("div",Ut,[e("label",Tt,[u(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>o.form.is_active=l),type:"checkbox"},null,512),[[E,o.form.is_active]]),t[31]||(t[31]=e("span",{class:"checkmark"},null,-1)),t[32]||(t[32]=A(" Active Customer ",-1))])])]),e("div",It,[e("button",{type:"button",onClick:t[13]||(t[13]=l=>f.$emit("close")),class:"btn btn-secondary"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:o.saving},[o.saving?(m(),v("span",Bt)):_("",!0),A(" "+r(o.saving?"Saving...":o.isEdit?"Update Customer":"Add Customer"),1)],8,Nt)])],32)])])])}const Lt=Q(at,[["render",qt],["__scopeId","data-v-18c15bf8"]]),zt={name:"AdminCustomers",components:{AdminLayout:it,CustomerModal:Lt},setup(){const f=d([]),t=d(!1),p=d(""),o=d(""),c=d("created_at"),b=d(1),l=d(20),k=d(0),s=d([]),g=d(!1),i=d(!1),x=d(null),U=d(0),T=d(0),M=V(()=>Math.ceil(k.value/l.value)),J=V(()=>{const n=[],a=Math.max(1,b.value-2),F=Math.min(M.value,b.value+2);for(let w=a;w<=F;w++)n.push(w);return n}),C=async()=>{t.value=!0;try{const n={page:b.value,page_size:l.value,search:p.value,status:o.value,sort_by:c.value},a=await S.get("/api/customers/",{params:n});if(f.value=a.data.results||a.data,k.value=a.data.count||a.data.length,a.data.results){U.value=a.data.results.filter(w=>w.is_active).length;const F=new Date;F.setDate(1),F.setHours(0,0,0,0),T.value=a.data.results.filter(w=>new Date(w.created_at)>=F).length}}catch(n){console.error("Failed to fetch customers:",n),alert("Failed to load customers. Please try again.")}finally{t.value=!1}},G=rt(()=>{b.value=1,C()},500),H=()=>{b.value=1,C()},K=n=>{n>=1&&n<=M.value&&(b.value=n,C())},R=()=>{g.value?s.value=f.value.map(n=>n.id):s.value=[]},P=()=>{s.value=[],g.value=!1},W=n=>{console.log("View customer:",n)},X=n=>{x.value={...n},i.value=!0},I=()=>{i.value=!1,x.value=null},Y=async n=>{try{x.value?await S.put(`/api/customers/${x.value.id}/`,n):await S.post("/api/customers/",n),I(),C()}catch(a){console.error("Failed to save customer:",a),alert("Failed to save customer. Please try again.")}},Z=async n=>{try{await S.patch(`/api/customers/${n.id}/`,{is_active:!n.is_active}),C()}catch(a){console.error("Failed to toggle customer status:",a),alert("Failed to update customer status.")}},$=async n=>{if(confirm(`Are you sure you want to delete ${n.name}?`))try{await S.delete(`/api/customers/${n.id}/`),C()}catch(a){console.error("Failed to delete customer:",a),alert("Failed to delete customer. Please try again.")}},tt=async()=>{try{await S.patch("/api/customers/bulk_update/",{customer_ids:s.value,action:"toggle_status"}),C(),P()}catch(n){console.error("Failed to bulk update customers:",n),alert("Failed to update customers.")}},et=async()=>{if(confirm(`Are you sure you want to delete ${s.value.length} customer(s)?`))try{await S.delete("/api/customers/bulk_delete/",{data:{customer_ids:s.value}}),C(),P()}catch(n){console.error("Failed to bulk delete customers:",n),alert("Failed to delete customers.")}},ot=()=>{console.log("Exporting customers...")},st=n=>new Date(n).toLocaleDateString(),lt=(n,a)=>n.length<=a?n:n.substring(0,a)+"...";return O([p,o,c],()=>{b.value=1}),j(()=>{C()}),{customers:f,loading:t,searchQuery:p,statusFilter:o,sortBy:c,currentPage:b,pageSize:l,totalCustomers:k,selectedCustomers:s,selectAll:g,showAddCustomerModal:i,editingCustomer:x,activeCustomers:U,newCustomersThisMonth:T,totalPages:M,visiblePages:J,debouncedSearch:G,applyFilters:H,changePage:K,toggleSelectAll:R,clearSelection:P,viewCustomer:W,editCustomer:X,closeCustomerModal:I,saveCustomer:Y,toggleCustomerStatus:Z,deleteCustomer:$,bulkToggleStatus:tt,bulkDelete:et,exportCustomers:ot,formatDate:st,truncateText:lt}}},Ot={class:"admin-customers"},jt={class:"page-header"},Qt={class:"header-content"},Jt=["disabled"],Gt={class:"filters-section"},Ht={class:"search-box"},Kt={class:"filter-controls"},Rt={class:"stats-row"},Wt={class:"stat-card"},Xt={class:"stat-content"},Yt={class:"stat-card"},Zt={class:"stat-content"},$t={class:"stat-card"},te={class:"stat-content"},ee={class:"table-container"},oe={class:"table-header"},se={class:"table-actions"},le=["disabled"],ne={class:"table-wrapper"},ie={class:"data-table"},re=["disabled"],ae={key:0},de={key:1},ue={colspan:"8",class:"empty-row"},me=["value"],ce={class:"customer-info"},ve={class:"contact-info"},fe={class:"address-info"},be={class:"order-count"},ge={class:"date-info"},ye={class:"action-buttons"},pe=["onClick"],Ce=["onClick"],_e=["onClick","title"],ke=["onClick"],he={key:0,class:"pagination-container"},we={class:"pagination-info"},Se={class:"pagination"},Ae=["disabled"],xe=["onClick"],Fe=["disabled"],Me={key:0,class:"bulk-actions"},Pe={class:"bulk-info"},Ve={class:"bulk-buttons"};function De(f,t,p,o,c,b){const l=q("CustomerModal"),k=q("AdminLayout");return m(),B(k,null,{default:nt(()=>[e("div",Ot,[e("div",jt,[e("div",Qt,[t[18]||(t[18]=e("div",null,[e("h1",null,"Customer Management"),e("p",null,"Manage customer accounts and information")],-1)),e("button",{onClick:t[0]||(t[0]=s=>o.showAddCustomerModal=!0),class:"btn btn-primary",disabled:o.loading},[...t[17]||(t[17]=[e("i",{class:"icon-user-plus"},null,-1),A(" Add Customer ",-1)])],8,Jt)])]),e("div",Gt,[e("div",Ht,[t[19]||(t[19]=e("i",{class:"icon-search"},null,-1)),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.searchQuery=s),type:"text",placeholder:"Search customers...",onInput:t[2]||(t[2]=(...s)=>o.debouncedSearch&&o.debouncedSearch(...s))},null,544),[[y,o.searchQuery]])]),e("div",Kt,[u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.statusFilter=s),onChange:t[4]||(t[4]=(...s)=>o.applyFilters&&o.applyFilters(...s))},[...t[20]||(t[20]=[e("option",{value:""},"All Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)])],544),[[D,o.statusFilter]]),u(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.sortBy=s),onChange:t[6]||(t[6]=(...s)=>o.applyFilters&&o.applyFilters(...s))},[...t[21]||(t[21]=[e("option",{value:"created_at"},"Sort by Date",-1),e("option",{value:"name"},"Sort by Name",-1),e("option",{value:"email"},"Sort by Email",-1)])],544),[[D,o.sortBy]])])]),e("div",Rt,[e("div",Wt,[t[23]||(t[23]=e("div",{class:"stat-icon"},[e("i",{class:"icon-users"})],-1)),e("div",Xt,[e("h3",null,r(o.totalCustomers),1),t[22]||(t[22]=e("p",null,"Total Customers",-1))])]),e("div",Yt,[t[25]||(t[25]=e("div",{class:"stat-icon active"},[e("i",{class:"icon-user-check"})],-1)),e("div",Zt,[e("h3",null,r(o.activeCustomers),1),t[24]||(t[24]=e("p",null,"Active Customers",-1))])]),e("div",$t,[t[27]||(t[27]=e("div",{class:"stat-icon new"},[e("i",{class:"icon-user-plus"})],-1)),e("div",te,[e("h3",null,r(o.newCustomersThisMonth),1),t[26]||(t[26]=e("p",null,"New This Month",-1))])])]),e("div",ee,[e("div",oe,[t[29]||(t[29]=e("h3",null,"Customers",-1)),e("div",se,[e("button",{onClick:t[7]||(t[7]=(...s)=>o.exportCustomers&&o.exportCustomers(...s)),class:"btn btn-secondary btn-sm",disabled:o.loading||o.customers.length===0},[...t[28]||(t[28]=[e("i",{class:"icon-download"},null,-1),A(" Export ",-1)])],8,le)])]),e("div",ne,[e("table",ie,[e("thead",null,[e("tr",null,[e("th",null,[u(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=s=>o.selectAll=s),onChange:t[9]||(t[9]=(...s)=>o.toggleSelectAll&&o.toggleSelectAll(...s)),disabled:o.customers.length===0},null,40,re),[[E,o.selectAll]])]),t[30]||(t[30]=e("th",null,"Customer",-1)),t[31]||(t[31]=e("th",null,"Contact",-1)),t[32]||(t[32]=e("th",null,"Address",-1)),t[33]||(t[33]=e("th",null,"Status",-1)),t[34]||(t[34]=e("th",null,"Orders",-1)),t[35]||(t[35]=e("th",null,"Joined",-1)),t[36]||(t[36]=e("th",null,"Actions",-1))])]),e("tbody",null,[o.loading?(m(),v("tr",ae,[...t[37]||(t[37]=[e("td",{colspan:"8",class:"loading-row"},[e("div",{class:"loading-spinner"}),A(" Loading customers... ")],-1)])])):o.customers.length===0?(m(),v("tr",de,[e("td",ue,[t[38]||(t[38]=e("i",{class:"icon-users"},null,-1)),t[39]||(t[39]=e("p",null,"No customers found",-1)),e("button",{onClick:t[10]||(t[10]=s=>o.showAddCustomerModal=!0),class:"btn btn-primary btn-sm"}," Add First Customer ")])])):_("",!0),(m(!0),v(L,null,z(o.customers,s=>(m(),v("tr",{key:s.id},[e("td",null,[u(e("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=g=>o.selectedCustomers=g),value:s.id},null,8,me),[[E,o.selectedCustomers]])]),e("td",null,[e("div",ce,[t[40]||(t[40]=e("div",{class:"customer-avatar"},[e("i",{class:"icon-user"})],-1)),e("div",null,[e("h4",null,r(s.name),1),e("small",null,"ID: "+r(s.id),1)])])]),e("td",null,[e("div",ve,[e("div",null,r(s.email),1),e("div",null,r(s.phone),1)])]),e("td",null,[e("div",fe,r(o.truncateText(s.address,50)),1)]),e("td",null,[e("span",{class:h(["status-badge",s.is_active?"active":"inactive"])},r(s.is_active?"Active":"Inactive"),3)]),e("td",null,[e("span",be,r(s.deliveries_count||0),1)]),e("td",null,[e("div",ge,r(o.formatDate(s.created_at)),1)]),e("td",null,[e("div",ye,[e("button",{onClick:g=>o.viewCustomer(s),class:"btn-icon",title:"View Details"},[...t[41]||(t[41]=[e("i",{class:"icon-eye"},null,-1)])],8,pe),e("button",{onClick:g=>o.editCustomer(s),class:"btn-icon",title:"Edit Customer"},[...t[42]||(t[42]=[e("i",{class:"icon-edit"},null,-1)])],8,Ce),e("button",{onClick:g=>o.toggleCustomerStatus(s),class:h(["btn-icon",s.is_active?"text-warning":"text-success"]),title:s.is_active?"Deactivate":"Activate"},[e("i",{class:h(s.is_active?"icon-pause":"icon-play")},null,2)],10,_e),e("button",{onClick:g=>o.deleteCustomer(s),class:"btn-icon text-danger",title:"Delete Customer"},[...t[43]||(t[43]=[e("i",{class:"icon-trash-2"},null,-1)])],8,ke)])])]))),128))])])]),o.totalPages>1?(m(),v("div",he,[e("div",we," Showing "+r((o.currentPage-1)*o.pageSize+1)+" to "+r(Math.min(o.currentPage*o.pageSize,o.totalCustomers))+" of "+r(o.totalCustomers)+" customers ",1),e("div",Se,[e("button",{onClick:t[12]||(t[12]=s=>o.changePage(o.currentPage-1)),disabled:o.currentPage===1,class:"page-btn"},[...t[44]||(t[44]=[e("i",{class:"icon-chevron-left"},null,-1)])],8,Ae),(m(!0),v(L,null,z(o.visiblePages,s=>(m(),v("button",{key:s,onClick:g=>o.changePage(s),class:h(["page-btn",{active:s===o.currentPage}])},r(s),11,xe))),128)),e("button",{onClick:t[13]||(t[13]=s=>o.changePage(o.currentPage+1)),disabled:o.currentPage===o.totalPages,class:"page-btn"},[...t[45]||(t[45]=[e("i",{class:"icon-chevron-right"},null,-1)])],8,Fe)])])):_("",!0)]),o.selectedCustomers.length>0?(m(),v("div",Me,[e("div",Pe,r(o.selectedCustomers.length)+" customer(s) selected ",1),e("div",Ve,[e("button",{onClick:t[14]||(t[14]=(...s)=>o.bulkToggleStatus&&o.bulkToggleStatus(...s)),class:"btn btn-secondary btn-sm"},[...t[46]||(t[46]=[e("i",{class:"icon-toggle-left"},null,-1),A(" Toggle Status ",-1)])]),e("button",{onClick:t[15]||(t[15]=(...s)=>o.bulkDelete&&o.bulkDelete(...s)),class:"btn btn-danger btn-sm"},[...t[47]||(t[47]=[e("i",{class:"icon-trash-2"},null,-1),A(" Delete Selected ",-1)])]),e("button",{onClick:t[16]||(t[16]=(...s)=>o.clearSelection&&o.clearSelection(...s)),class:"btn btn-secondary btn-sm"}," Clear Selection ")])])):_("",!0)]),o.showAddCustomerModal||o.editingCustomer?(m(),B(l,{key:0,customer:o.editingCustomer,onClose:o.closeCustomerModal,onSave:o.saveCustomer},null,8,["customer","onClose","onSave"])):_("",!0)]),_:1})}const qe=Q(zt,[["render",De],["__scopeId","data-v-c6ee5484"]]);export{qe as default};
