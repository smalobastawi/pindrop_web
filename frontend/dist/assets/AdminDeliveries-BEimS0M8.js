import{A as w}from"./AdminLayout-Cny3dS76.js";import{_ as M,a as g,u as A}from"./index-Ba6kPx5P.js";import{d as C}from"./debounce-B9j8fP-T.js";import{k as R,w as f,g as y,o as r,f as e,e as o,h as u,i as P,j as d,L as c,M as b,N as h,H as a,F as m,I as k,J as v,K as D}from"./vendor-CVqOb0XR.js";import"./ui-D_DTyfBr.js";const N={name:"AdminDeliveries",components:{AdminLayout:w},data(){return{deliveries:[],loading:!1,error:null,searchQuery:"",statusFilter:"",priorityFilter:"",currentPage:1,totalPages:1,pageSize:20,showAssignModal:!1,showStatusModal:!1,selectedDelivery:null,availableRiders:[],availableRidersLoading:!1,selectedRider:null,assigning:!1,newStatus:"",statusNotes:"",updating:!1}},computed:{canManageDeliveries(){return A().canManageDeliveries}},mounted(){this.debouncedSearch=C(this.fetchDeliveries,500),this.fetchDeliveries()},methods:{async fetchDeliveries(){this.loading=!0,this.error=null;try{const l={page:this.currentPage,page_size:this.pageSize};this.searchQuery&&(l.search=this.searchQuery),this.statusFilter&&(l.status=this.statusFilter),this.priorityFilter&&(l.priority=this.priorityFilter);const s=await g.get("/admin-api/api/deliveries/",{params:l});this.deliveries=s.data.results||s.data,this.totalPages=Math.ceil((s.data.count||this.deliveries.length)/this.pageSize)}catch(l){console.error("Error fetching deliveries:",l),this.error="Failed to load deliveries. Please try again."}finally{this.loading=!1}},resetFilters(){this.searchQuery="",this.statusFilter="",this.priorityFilter="",this.currentPage=1,this.fetchDeliveries()},goToPage(l){l>=1&&l<=this.totalPages&&(this.currentPage=l,this.fetchDeliveries())},getStatusClass(l){return`status-${l}`},formatDate(l){if(!l)return"N/A";const s=new Date(l);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},viewDelivery(l){this.$router.push(`/admin/deliveries/${l.id}`)},async showAssignRiderModal(l){this.selectedDelivery=l,this.selectedRider=null,this.showAssignModal=!0,await this.fetchAvailableRiders()},closeAssignModal(){this.showAssignModal=!1,this.selectedDelivery=null,this.selectedRider=null,this.availableRiders=[]},async fetchAvailableRiders(){this.availableRidersLoading=!0;try{const l=await g.get("/admin-api/api/riders/active_riders/");this.availableRiders=l.data.riders||[]}catch(l){console.error("Error fetching available riders:",l),this.availableRiders=[]}finally{this.availableRidersLoading=!1}},selectRider(l){this.selectedRider=l},async assignRider(){if(!(!this.selectedRider||!this.selectedDelivery)){this.assigning=!0;try{await g.post(`/admin-api/api/deliveries/${this.selectedDelivery.id}/assign_rider/`,{rider_id:this.selectedRider.id}),await this.fetchDeliveries(),this.closeAssignModal(),alert("Rider assigned successfully!")}catch(l){console.error("Error assigning rider:",l),alert("Failed to assign rider. Please try again.")}finally{this.assigning=!1}}},showUpdateStatusModal(l){this.selectedDelivery=l,this.newStatus=l.status,this.statusNotes="",this.showStatusModal=!0},closeStatusModal(){this.showStatusModal=!1,this.selectedDelivery=null,this.newStatus="",this.statusNotes=""},async updateStatus(){if(!(!this.newStatus||!this.selectedDelivery)){this.updating=!0;try{await g.post(`/admin-api/api/deliveries/${this.selectedDelivery.id}/update_status/`,{status:this.newStatus,notes:this.statusNotes}),await this.fetchDeliveries(),this.closeStatusModal(),alert("Delivery status updated successfully!")}catch(l){console.error("Error updating status:",l),alert("Failed to update status. Please try again.")}finally{this.updating=!1}}}}},F={class:"admin-deliveries"},U={class:"page-header"},L={class:"filters-section"},x={class:"filters-row"},T={class:"search-box"},V={class:"filter-group"},E={class:"deliveries-table-container"},Q={key:0,class:"loading-spinner"},z={key:1,class:"error-message"},I={key:2,class:"deliveries-table"},B={class:"user-info"},j={class:"name"},H={class:"phone"},J={class:"user-info"},K={class:"name"},q={class:"phone"},G={key:0,class:"rider-info"},O={class:"name"},W={class:"vehicle"},X={key:1,class:"no-rider"},Y={class:"actions"},Z=["onClick"],$=["onClick"],ee=["onClick"],se={key:3,class:"no-deliveries"},te={key:0,class:"pagination"},ie=["disabled"],le={class:"page-info"},ne=["disabled"],ae={class:"modal-header"},re={class:"modal-body"},oe={class:"rider-selection"},de={key:0,class:"loading-spinner"},ue={key:1,class:"no-riders"},ce={key:2,class:"riders-list"},ge=["onClick"],ve={class:"rider-name"},pe={class:"rider-details"},he={class:"rider-contact"},fe={class:"modal-footer"},ye=["disabled"],be={key:0,class:"fas fa-spinner fa-spin"},me={class:"modal-header"},ke={class:"modal-body"},De={class:"form-group"},Se={class:"form-group"},_e={class:"modal-footer"},we=["disabled"],Me={key:0,class:"fas fa-spinner fa-spin"};function Ae(l,s,Ce,Re,i,n){const S=y("router-link"),_=y("AdminLayout");return r(),R(_,null,{default:f(()=>[e("div",F,[e("div",U,[s[23]||(s[23]=e("h1",null,"Delivery Management",-1)),s[24]||(s[24]=e("p",null,"Manage all delivery orders and track shipments",-1)),P(S,{to:"/admin/deliveries/new",class:"btn btn-primary"},{default:f(()=>[...s[22]||(s[22]=[e("i",{class:"fas fa-plus"},null,-1),d(" Create New Delivery ",-1)])]),_:1})]),e("div",L,[e("div",x,[e("div",T,[s[25]||(s[25]=e("i",{class:"fas fa-search"},null,-1)),c(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>i.searchQuery=t),type:"text",placeholder:"Search by tracking number, sender, or recipient...",onInput:s[1]||(s[1]=(...t)=>l.debouncedSearch&&l.debouncedSearch(...t))},null,544),[[b,i.searchQuery]])]),e("div",V,[c(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>i.statusFilter=t),onChange:s[3]||(s[3]=(...t)=>n.fetchDeliveries&&n.fetchDeliveries(...t))},[...s[26]||(s[26]=[e("option",{value:""},"All Statuses",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"assigned"},"Assigned",-1),e("option",{value:"picked_up"},"Picked Up",-1),e("option",{value:"in_transit"},"In Transit",-1),e("option",{value:"delivered"},"Delivered",-1),e("option",{value:"cancelled"},"Cancelled",-1)])],544),[[h,i.statusFilter]]),c(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>i.priorityFilter=t),onChange:s[5]||(s[5]=(...t)=>n.fetchDeliveries&&n.fetchDeliveries(...t))},[...s[27]||(s[27]=[e("option",{value:""},"All Priorities",-1),e("option",{value:"1"},"Normal",-1),e("option",{value:"2"},"Express",-1),e("option",{value:"3"},"Urgent",-1),e("option",{value:"4"},"Same Day",-1)])],544),[[h,i.priorityFilter]]),e("button",{onClick:s[6]||(s[6]=(...t)=>n.resetFilters&&n.resetFilters(...t)),class:"btn btn-secondary"},[...s[28]||(s[28]=[e("i",{class:"fas fa-times"},null,-1),d(" Reset ",-1)])])])])]),e("div",E,[i.loading?(r(),o("div",Q,[...s[29]||(s[29]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),d(" Loading deliveries... ",-1)])])):i.error?(r(),o("div",z,[s[30]||(s[30]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),d(" "+a(i.error)+" ",1),e("button",{onClick:s[7]||(s[7]=(...t)=>n.fetchDeliveries&&n.fetchDeliveries(...t)),class:"btn btn-primary"},"Retry")])):i.deliveries.length>0?(r(),o("table",I,[s[34]||(s[34]=e("thead",null,[e("tr",null,[e("th",null,"Tracking #"),e("th",null,"Sender"),e("th",null,"Recipient"),e("th",null,"Status"),e("th",null,"Priority"),e("th",null,"Rider"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),o(m,null,k(i.deliveries,t=>(r(),o("tr",{key:t.id,class:v(n.getStatusClass(t.status))},[e("td",null,[e("strong",null,a(t.tracking_number),1)]),e("td",null,[e("div",B,[e("div",j,a(t.sender_details?.name||"N/A"),1),e("div",H,a(t.sender_details?.phone||""),1)])]),e("td",null,[e("div",J,[e("div",K,a(t.recipient_name),1),e("div",q,a(t.recipient_phone),1)])]),e("td",null,[e("span",{class:v(`status-badge status-${t.status}`)},a(t.status_display),3)]),e("td",null,[e("span",{class:v(`priority-badge priority-${t.priority}`)},a(t.priority_display),3)]),e("td",null,[t.rider_details?(r(),o("div",G,[e("div",O,a(t.rider_details.name),1),e("div",W,a(t.rider_details.vehicle_type)+" - "+a(t.rider_details.vehicle_plate),1)])):(r(),o("span",X,"Unassigned"))]),e("td",null,a(n.formatDate(t.created_at)),1),e("td",null,[e("div",Y,[e("button",{onClick:p=>n.viewDelivery(t),class:"btn btn-sm btn-info",title:"View Details"},[...s[31]||(s[31]=[e("i",{class:"fas fa-eye"},null,-1)])],8,Z),!t.rider_details&&n.canManageDeliveries?(r(),o("button",{key:0,onClick:p=>n.showAssignRiderModal(t),class:"btn btn-sm btn-warning",title:"Assign Rider"},[...s[32]||(s[32]=[e("i",{class:"fas fa-user-plus"},null,-1)])],8,$)):u("",!0),n.canManageDeliveries?(r(),o("button",{key:1,onClick:p=>n.showUpdateStatusModal(t),class:"btn btn-sm btn-secondary",title:"Update Status"},[...s[33]||(s[33]=[e("i",{class:"fas fa-edit"},null,-1)])],8,ee)):u("",!0)])])],2))),128))])])):(r(),o("div",se,[...s[35]||(s[35]=[e("i",{class:"fas fa-inbox"},null,-1),e("h3",null,"No deliveries found",-1),e("p",null,"Try adjusting your filters or create a new delivery.",-1)])]))]),i.totalPages>1?(r(),o("div",te,[e("button",{onClick:s[8]||(s[8]=t=>n.goToPage(i.currentPage-1)),disabled:i.currentPage===1,class:"btn btn-secondary"},[...s[36]||(s[36]=[e("i",{class:"fas fa-chevron-left"},null,-1),d(" Previous ",-1)])],8,ie),e("span",le," Page "+a(i.currentPage)+" of "+a(i.totalPages),1),e("button",{onClick:s[9]||(s[9]=t=>n.goToPage(i.currentPage+1)),disabled:i.currentPage===i.totalPages,class:"btn btn-secondary"},[...s[37]||(s[37]=[d(" Next ",-1),e("i",{class:"fas fa-chevron-right"},null,-1)])],8,ne)])):u("",!0),i.showAssignModal?(r(),o("div",{key:1,class:"modal-overlay",onClick:s[14]||(s[14]=(...t)=>n.closeAssignModal&&n.closeAssignModal(...t))},[e("div",{class:"modal-content",onClick:s[13]||(s[13]=D(()=>{},["stop"]))},[e("div",ae,[s[38]||(s[38]=e("h3",null,"Assign Rider to Delivery",-1)),e("button",{onClick:s[10]||(s[10]=(...t)=>n.closeAssignModal&&n.closeAssignModal(...t)),class:"close-btn"},"×")]),e("div",re,[e("p",null,[s[39]||(s[39]=e("strong",null,"Delivery:",-1)),d(" "+a(i.selectedDelivery?.tracking_number),1)]),e("p",null,[s[40]||(s[40]=e("strong",null,"From:",-1)),d(" "+a(i.selectedDelivery?.pickup_address),1)]),e("p",null,[s[41]||(s[41]=e("strong",null,"To:",-1)),d(" "+a(i.selectedDelivery?.delivery_address),1)]),e("div",oe,[s[43]||(s[43]=e("h4",null,"Select Available Rider:",-1)),i.availableRidersLoading?(r(),o("div",de,[...s[42]||(s[42]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),d(" Loading riders... ",-1)])])):i.availableRiders.length===0?(r(),o("div",ue," No available riders found. ")):(r(),o("div",ce,[(r(!0),o(m,null,k(i.availableRiders,t=>(r(),o("div",{key:t.id,class:v(["rider-option",{selected:i.selectedRider?.id===t.id}]),onClick:p=>n.selectRider(t)},[e("div",ve,a(t.name),1),e("div",pe,a(t.vehicle_type)+" - "+a(t.vehicle_plate),1),e("div",he,a(t.phone),1)],10,ge))),128))]))])]),e("div",fe,[e("button",{onClick:s[11]||(s[11]=(...t)=>n.closeAssignModal&&n.closeAssignModal(...t)),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:s[12]||(s[12]=(...t)=>n.assignRider&&n.assignRider(...t)),disabled:!i.selectedRider||i.assigning,class:"btn btn-primary"},[i.assigning?(r(),o("i",be)):u("",!0),d(" "+a(i.assigning?"Assigning...":"Assign Rider"),1)],8,ye)])])])):u("",!0),i.showStatusModal?(r(),o("div",{key:2,class:"modal-overlay",onClick:s[21]||(s[21]=(...t)=>n.closeStatusModal&&n.closeStatusModal(...t))},[e("div",{class:"modal-content",onClick:s[20]||(s[20]=D(()=>{},["stop"]))},[e("div",me,[s[44]||(s[44]=e("h3",null,"Update Delivery Status",-1)),e("button",{onClick:s[15]||(s[15]=(...t)=>n.closeStatusModal&&n.closeStatusModal(...t)),class:"close-btn"},"×")]),e("div",ke,[e("p",null,[s[45]||(s[45]=e("strong",null,"Delivery:",-1)),d(" "+a(i.selectedDelivery?.tracking_number),1)]),e("p",null,[s[46]||(s[46]=e("strong",null,"Current Status:",-1)),d(" "+a(i.selectedDelivery?.status_display),1)]),e("div",De,[s[48]||(s[48]=e("label",{for:"newStatus"},"New Status:",-1)),c(e("select",{id:"newStatus","onUpdate:modelValue":s[16]||(s[16]=t=>i.newStatus=t)},[...s[47]||(s[47]=[e("option",{value:"pending"},"Pending",-1),e("option",{value:"assigned"},"Assigned",-1),e("option",{value:"picked_up"},"Picked Up",-1),e("option",{value:"in_transit"},"In Transit",-1),e("option",{value:"delivered"},"Delivered",-1),e("option",{value:"cancelled"},"Cancelled",-1)])],512),[[h,i.newStatus]])]),e("div",Se,[s[49]||(s[49]=e("label",{for:"statusNotes"},"Notes (optional):",-1)),c(e("textarea",{id:"statusNotes","onUpdate:modelValue":s[17]||(s[17]=t=>i.statusNotes=t),placeholder:"Add any notes about this status change...",rows:"3"},null,512),[[b,i.statusNotes]])])]),e("div",_e,[e("button",{onClick:s[18]||(s[18]=(...t)=>n.closeStatusModal&&n.closeStatusModal(...t)),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:s[19]||(s[19]=(...t)=>n.updateStatus&&n.updateStatus(...t)),disabled:!i.newStatus||i.updating,class:"btn btn-primary"},[i.updating?(r(),o("i",Me)):u("",!0),d(" "+a(i.updating?"Updating...":"Update Status"),1)],8,we)])])])):u("",!0)])]),_:1})}const xe=M(N,[["render",Ae],["__scopeId","data-v-ad10643a"]]);export{xe as default};
