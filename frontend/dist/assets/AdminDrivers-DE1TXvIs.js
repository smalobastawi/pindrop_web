import{A as b}from"./AdminLayout-Cny3dS76.js";import{_ as y,a as v,u as D}from"./index-Ba6kPx5P.js";import{k,w as C,g as A,o,f as t,e as r,h as d,L as p,N as _,M as w,j as x,H as a,F as g,I as m,J as h}from"./vendor-CVqOb0XR.js";import"./ui-D_DTyfBr.js";const S={name:"AdminDrivers",components:{AdminLayout:b},data(){return{drivers:[],loading:!1,error:null,filters:{status:"",vehicle_type:"",search:""},pagination:{current_page:1,total_pages:1,next:null,previous:null,count:0},showAddDriverModal:!1,searchTimeout:null}},computed:{adminAuth(){return D()}},mounted(){this.fetchDrivers()},methods:{async fetchDrivers(i=1){this.loading=!0,this.error=null;try{const e={page:i,page_size:20};this.filters.status&&(e.status=this.filters.status),this.filters.vehicle_type&&(e.vehicle_type=this.filters.vehicle_type),this.filters.search&&(e.search=this.filters.search);const c=await v.get("/admin-api/api/riders/",{params:e});this.drivers=c.data.results||c.data,this.updatePagination(c.data)}catch(e){console.error("Error fetching drivers:",e),this.error=e.response?.data?.message||"Failed to load drivers"}finally{this.loading=!1}},updatePagination(i){i.next||i.previous?this.pagination={current_page:Math.ceil((i.offset||0)/(i.limit||20))+1,total_pages:Math.ceil(i.count/(i.limit||20)),next:i.next,previous:i.previous,count:i.count}:this.pagination={current_page:1,total_pages:1,next:null,previous:null,count:this.drivers.length}},goToPage(i){if(!i)return;const c=new URL(i).searchParams.get("page");this.fetchDrivers(parseInt(c))},debounceSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.fetchDrivers()},500)},clearFilters(){this.filters={status:"",vehicle_type:"",search:""},this.fetchDrivers()},viewDriver(i){console.log("View driver:",i)},editDriver(i){console.log("Edit driver:",i)},async approveDriver(i){if(confirm(`Are you sure you want to approve ${i.full_name}?`))try{await v.post(`/admin-api/api/riders/${i.id}/approve_rider/`),this.fetchDrivers()}catch(e){console.error("Error approving driver:",e),alert("Failed to approve driver")}},async toggleDriverStatus(i){const e=i.status==="active"?"deactivate":"activate";if(confirm(`Are you sure you want to ${e} ${i.full_name}?`))try{const c=i.status==="active"?"inactive":"active";await v.patch(`/admin-api/api/riders/${i.id}/`,{status:c}),this.fetchDrivers()}catch(c){console.error("Error updating driver status:",c),alert("Failed to update driver status")}}}},T={class:"admin-drivers"},F={class:"filters-section"},M={class:"filters"},V={class:"actions"},P={key:0,class:"loading"},L={key:1,class:"error-message"},N={key:2,class:"drivers-table-container"},E={class:"drivers-table"},I={class:"driver-info"},U={class:"driver-avatar"},B=["src","alt"],j={key:1,class:"avatar-placeholder"},R={class:"driver-details"},z={class:"driver-name"},O={class:"driver-id"},H={class:"contact-info"},J={class:"contact-email"},q={class:"contact-phone"},G={class:"vehicle-info"},K={class:"vehicle-type"},Q={class:"vehicle-plate"},W={key:0,class:"vehicle-model"},X={class:"status-info"},Y={key:0,class:"availability"},Z={class:"rating-info"},$={class:"rating"},tt={class:"rating-stars"},et={class:"rating-value"},st={class:"rating-count"},it={class:"deliveries-info"},lt={class:"completed-deliveries"},nt={key:0,class:"success-rate"},ot={class:"actions"},at={class:"action-buttons"},rt=["onClick"],ct=["onClick"],ut=["onClick"],dt=["onClick"],vt=["onClick"],pt={key:0,class:"empty-state"},ht={key:3,class:"pagination"},_t=["disabled"],gt={class:"page-info"},mt=["disabled"];function ft(i,e,c,bt,l,n){const f=A("AdminLayout");return o(),k(f,null,{default:C(()=>[t("div",T,[e[25]||(e[25]=t("div",{class:"page-header"},[t("h1",null,"Driver Management"),t("p",null,"Manage delivery drivers and riders")],-1)),t("div",F,[t("div",M,[p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.filters.status=s),onChange:e[1]||(e[1]=(...s)=>n.fetchDrivers&&n.fetchDrivers(...s))},[...e[11]||(e[11]=[t("option",{value:""},"All Status",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"pending_approval"},"Pending Approval",-1),t("option",{value:"suspended"},"Suspended",-1)])],544),[[_,l.filters.status]]),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.filters.vehicle_type=s),onChange:e[3]||(e[3]=(...s)=>n.fetchDrivers&&n.fetchDrivers(...s))},[...e[12]||(e[12]=[t("option",{value:""},"All Vehicle Types",-1),t("option",{value:"bicycle"},"Bicycle",-1),t("option",{value:"motorcycle"},"Motorcycle",-1),t("option",{value:"car"},"Car",-1),t("option",{value:"van"},"Van",-1),t("option",{value:"truck"},"Truck",-1)])],544),[[_,l.filters.vehicle_type]]),p(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>l.filters.search=s),placeholder:"Search by name, email, or phone...",onInput:e[5]||(e[5]=(...s)=>n.debounceSearch&&n.debounceSearch(...s))},null,544),[[w,l.filters.search]])]),t("div",V,[t("button",{class:"btn btn-primary",onClick:e[6]||(e[6]=s=>l.showAddDriverModal=!0)},[...e[13]||(e[13]=[t("i",{class:"icon-plus"},null,-1),x(" Add Driver ",-1)])])])]),l.loading?(o(),r("div",P,[...e[14]||(e[14]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading drivers...",-1)])])):l.error?(o(),r("div",L,[e[15]||(e[15]=t("i",{class:"icon-error"},null,-1)),t("p",null,a(l.error),1),t("button",{class:"btn btn-secondary",onClick:e[7]||(e[7]=(...s)=>n.fetchDrivers&&n.fetchDrivers(...s))},"Retry")])):(o(),r("div",N,[t("table",E,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",null,"Driver"),t("th",null,"Contact"),t("th",null,"Vehicle"),t("th",null,"Status"),t("th",null,"Rating"),t("th",null,"Deliveries"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),r(g,null,m(l.drivers,s=>(o(),r("tr",{key:s.id},[t("td",I,[t("div",U,[s.profile_image?(o(),r("img",{key:0,src:s.profile_image,alt:s.full_name},null,8,B)):(o(),r("div",j,a(s.full_name?s.full_name.charAt(0).toUpperCase():"D"),1))]),t("div",R,[t("div",z,a(s.full_name||s.user_details?.username),1),t("div",O,"ID: "+a(s.id),1)])]),t("td",H,[t("div",J,a(s.email),1),t("div",q,a(s.phone),1)]),t("td",G,[t("div",K,a(s.vehicle_type_display),1),t("div",Q,a(s.vehicle_plate),1),s.vehicle_model?(o(),r("div",W,a(s.vehicle_model),1)):d("",!0)]),t("td",X,[t("span",{class:h(`status-badge status-${s.status}`)},a(s.status_display),3),s.status==="active"?(o(),r("div",Y,[t("span",{class:h(`availability-badge ${s.is_available?"available":"unavailable"}`)},a(s.is_available?"Available":"Unavailable"),3)])):d("",!0)]),t("td",Z,[t("div",$,[t("span",tt,[(o(),r(g,null,m(5,u=>t("i",{key:u,class:h(u<=Math.floor(s.rating)?"icon-star-full":u<=s.rating?"icon-star-half":"icon-star-empty")},null,2)),64))]),t("span",et,a(s.rating.toFixed(1)),1)]),t("div",st,"("+a(s.total_ratings)+" reviews)",1)]),t("td",it,[t("div",lt,a(s.completed_deliveries),1),s.completed_deliveries>0?(o(),r("div",nt,a((s.completed_deliveries/(s.completed_deliveries+(s.assigned_deliveries||0))*100).toFixed(1))+"% success ",1)):d("",!0)]),t("td",ot,[t("div",at,[t("button",{class:"btn btn-sm btn-outline",onClick:u=>n.viewDriver(s),title:"View Details"},[...e[16]||(e[16]=[t("i",{class:"icon-eye"},null,-1)])],8,rt),t("button",{class:"btn btn-sm btn-outline",onClick:u=>n.editDriver(s),title:"Edit Driver"},[...e[17]||(e[17]=[t("i",{class:"icon-edit"},null,-1)])],8,ct),s.status==="pending_approval"?(o(),r("button",{key:0,class:"btn btn-sm btn-success",onClick:u=>n.approveDriver(s),title:"Approve Driver"},[...e[18]||(e[18]=[t("i",{class:"icon-check"},null,-1)])],8,ut)):d("",!0),s.status==="active"?(o(),r("button",{key:1,class:"btn btn-sm btn-warning",onClick:u=>n.toggleDriverStatus(s),title:"Deactivate Driver"},[...e[19]||(e[19]=[t("i",{class:"icon-pause"},null,-1)])],8,dt)):s.status==="inactive"?(o(),r("button",{key:2,class:"btn btn-sm btn-success",onClick:u=>n.toggleDriverStatus(s),title:"Activate Driver"},[...e[20]||(e[20]=[t("i",{class:"icon-play"},null,-1)])],8,vt)):d("",!0)])])]))),128))])]),l.drivers.length===0?(o(),r("div",pt,[e[22]||(e[22]=t("i",{class:"icon-truck"},null,-1)),e[23]||(e[23]=t("h3",null,"No drivers found",-1)),e[24]||(e[24]=t("p",null,"No drivers match your current filters.",-1)),t("button",{class:"btn btn-primary",onClick:e[8]||(e[8]=(...s)=>n.clearFilters&&n.clearFilters(...s))},"Clear Filters")])):d("",!0)])),l.drivers.length>0?(o(),r("div",ht,[t("button",{class:"btn btn-outline",disabled:!l.pagination.previous,onClick:e[9]||(e[9]=s=>n.goToPage(l.pagination.previous))}," Previous ",8,_t),t("span",gt," Page "+a(l.pagination.current_page)+" of "+a(l.pagination.total_pages),1),t("button",{class:"btn btn-outline",disabled:!l.pagination.next,onClick:e[10]||(e[10]=s=>n.goToPage(l.pagination.next))}," Next ",8,mt)])):d("",!0)])]),_:1})}const At=y(S,[["render",ft],["__scopeId","data-v-ac11a5a4"]]);export{At as default};
