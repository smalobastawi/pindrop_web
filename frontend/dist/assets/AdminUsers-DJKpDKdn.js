import{r as v,b as P,B as X,s as N,e as p,f as e,H as i,K as S,h as w,L as d,M as f,N as F,P as Y,j as C,O as Z,o as m,k as x,w as $,g as V,F as E,I as D,J as k}from"./vendor-CVqOb0XR.js";import{A as ee}from"./AdminLayout-Cny3dS76.js";import{_ as L,a as U}from"./index-Ba6kPx5P.js";import{d as oe}from"./debounce-B9j8fP-T.js";import"./ui-D_DTyfBr.js";const se={name:"UserModal",props:{user:{type:Object,default:null}},emits:["close","save"],setup(u,{emit:o}){const g=v(!1),s=v({username:"",email:"",password:"",password_confirm:"",first_name:"",last_name:"",role:"",phone:"",employee_id:"",department:"",is_active:!0}),b=P(()=>!!u.user),c=()=>{s.value={username:"",email:"",password:"",password_confirm:"",first_name:"",last_name:"",role:"",phone:"",employee_id:"",department:"",is_active:!0}},l=n=>{s.value={username:n.user?.username||"",email:n.user?.email||"",password:"",password_confirm:"",first_name:n.user?.first_name||"",last_name:n.user?.last_name||"",role:n.role||"",phone:n.phone||"",employee_id:n.employee_id||"",department:n.department||"",is_active:n.is_active!==void 0?n.is_active:!0}},y=()=>{if(!s.value.username.trim())return alert("Username is required"),!1;if(!s.value.email.trim())return alert("Email is required"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value.email))return alert("Please enter a valid email address"),!1;if(!b.value){if(!s.value.password)return alert("Password is required"),!1;if(s.value.password!==s.value.password_confirm)return alert("Passwords do not match"),!1}return s.value.role?!0:(alert("Role is required"),!1)},t=async()=>{if(y()){g.value=!0;try{const n={...s.value};b.value&&(delete n.password_confirm,n.password||delete n.password),o("save",n)}catch(n){console.error("Form submission error:",n)}finally{g.value=!1}}};return X(()=>u.user,n=>{n?l(n):c()},{immediate:!0}),N(()=>{u.user&&l(u.user)}),{form:s,saving:g,isEdit:b,handleSubmit:t}}},te={class:"modal-header"},le={class:"modal-body"},ae={class:"form-section"},ne={class:"form-group"},re=["disabled"],ie={class:"form-group"},de={key:0,class:"form-group"},me={key:1,class:"form-group"},ue={class:"form-row"},ve={class:"form-group"},pe={class:"form-group"},ce={class:"form-section"},fe={class:"form-group"},ge={class:"form-row"},be={class:"form-group"},ye={class:"form-group"},_e={class:"form-group"},we={class:"form-group"},Ue={class:"checkbox-wrapper"},ke={class:"modal-actions"},Ce=["disabled"],he={key:0,class:"loading-spinner"};function Ae(u,o,g,s,b,c){return m(),p("div",{class:"modal-overlay",onClick:o[15]||(o[15]=l=>u.$emit("close"))},[e("div",{class:"modal",onClick:o[14]||(o[14]=S(()=>{},["stop"]))},[e("div",te,[e("h3",null,i(s.isEdit?"Edit User":"Add New User"),1),e("button",{onClick:o[0]||(o[0]=l=>u.$emit("close")),class:"close-btn"},"Ã—")]),e("div",le,[e("form",{onSubmit:o[13]||(o[13]=S((...l)=>s.handleSubmit&&s.handleSubmit(...l),["prevent"]))},[e("div",ae,[o[22]||(o[22]=e("h4",null,"User Information",-1)),e("div",ne,[o[16]||(o[16]=e("label",{for:"username"},"Username *",-1)),d(e("input",{id:"username","onUpdate:modelValue":o[1]||(o[1]=l=>s.form.username=l),type:"text",required:"",disabled:s.isEdit,placeholder:"Enter username"},null,8,re),[[f,s.form.username]])]),e("div",ie,[o[17]||(o[17]=e("label",{for:"email"},"Email Address *",-1)),d(e("input",{id:"email","onUpdate:modelValue":o[2]||(o[2]=l=>s.form.email=l),type:"email",required:"",placeholder:"Enter email address"},null,512),[[f,s.form.email]])]),s.isEdit?w("",!0):(m(),p("div",de,[o[18]||(o[18]=e("label",{for:"password"},"Password *",-1)),d(e("input",{id:"password","onUpdate:modelValue":o[3]||(o[3]=l=>s.form.password=l),type:"password",required:"",placeholder:"Enter password"},null,512),[[f,s.form.password]])])),s.isEdit?w("",!0):(m(),p("div",me,[o[19]||(o[19]=e("label",{for:"password_confirm"},"Confirm Password *",-1)),d(e("input",{id:"password_confirm","onUpdate:modelValue":o[4]||(o[4]=l=>s.form.password_confirm=l),type:"password",required:"",placeholder:"Confirm password"},null,512),[[f,s.form.password_confirm]])])),e("div",ue,[e("div",ve,[o[20]||(o[20]=e("label",{for:"first_name"},"First Name",-1)),d(e("input",{id:"first_name","onUpdate:modelValue":o[5]||(o[5]=l=>s.form.first_name=l),type:"text",placeholder:"Enter first name"},null,512),[[f,s.form.first_name]])]),e("div",pe,[o[21]||(o[21]=e("label",{for:"last_name"},"Last Name",-1)),d(e("input",{id:"last_name","onUpdate:modelValue":o[6]||(o[6]=l=>s.form.last_name=l),type:"text",placeholder:"Enter last name"},null,512),[[f,s.form.last_name]])])])]),e("div",ce,[o[30]||(o[30]=e("h4",null,"Admin Profile",-1)),e("div",fe,[o[24]||(o[24]=e("label",{for:"role"},"Role *",-1)),d(e("select",{id:"role","onUpdate:modelValue":o[7]||(o[7]=l=>s.form.role=l),required:""},[...o[23]||(o[23]=[Y('<option value="" data-v-8a300422>Select a role</option><option value="super_admin" data-v-8a300422>Super Administrator</option><option value="admin" data-v-8a300422>Administrator</option><option value="manager" data-v-8a300422>Manager</option><option value="operator" data-v-8a300422>Operator</option><option value="viewer" data-v-8a300422>Viewer</option>',6)])],512),[[F,s.form.role]])]),e("div",ge,[e("div",be,[o[25]||(o[25]=e("label",{for:"phone"},"Phone Number",-1)),d(e("input",{id:"phone","onUpdate:modelValue":o[8]||(o[8]=l=>s.form.phone=l),type:"tel",placeholder:"Enter phone number"},null,512),[[f,s.form.phone]])]),e("div",ye,[o[26]||(o[26]=e("label",{for:"employee_id"},"Employee ID",-1)),d(e("input",{id:"employee_id","onUpdate:modelValue":o[9]||(o[9]=l=>s.form.employee_id=l),type:"text",placeholder:"Enter employee ID"},null,512),[[f,s.form.employee_id]])])]),e("div",_e,[o[27]||(o[27]=e("label",{for:"department"},"Department",-1)),d(e("input",{id:"department","onUpdate:modelValue":o[10]||(o[10]=l=>s.form.department=l),type:"text",placeholder:"Enter department"},null,512),[[f,s.form.department]])]),e("div",we,[e("label",Ue,[d(e("input",{"onUpdate:modelValue":o[11]||(o[11]=l=>s.form.is_active=l),type:"checkbox"},null,512),[[Z,s.form.is_active]]),o[28]||(o[28]=e("span",{class:"checkmark"},null,-1)),o[29]||(o[29]=C(" Active User ",-1))])])]),e("div",ke,[e("button",{type:"button",onClick:o[12]||(o[12]=l=>u.$emit("close")),class:"btn btn-secondary"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:s.saving},[s.saving?(m(),p("span",he)):w("",!0),C(" "+i(s.saving?"Saving...":s.isEdit?"Update User":"Add User"),1)],8,Ce)])],32)])])])}const Pe=L(se,[["render",Ae],["__scopeId","data-v-8a300422"]]),Fe={name:"AdminUsers",components:{AdminLayout:ee,UserModal:Pe},setup(){const u=v([]),o=v(!1),g=v(""),s=v(""),b=v(""),c=v(1),l=v(20),y=v(0),t=v(!1),n=v(null),h=P(()=>Math.ceil(y.value/l.value)),I=P(()=>{const a=[],r=Math.max(1,c.value-2),W=Math.min(h.value,c.value+2);for(let A=r;A<=W;A++)a.push(A);return a}),_=async()=>{o.value=!0;try{const a={page:c.value,page_size:l.value,search:g.value,role:s.value,is_active:b.value},r=await U.get("/admin-api/api/users/",{params:a});u.value=r.data.results||r.data,y.value=r.data.count||r.data.length}catch(a){console.error("Failed to fetch users:",a),alert("Failed to load users. Please try again.")}finally{o.value=!1}},q=oe(()=>{c.value=1,_()},500),R=()=>{c.value=1,_()},z=a=>{a>=1&&a<=h.value&&(c.value=a,_())},B=a=>({super_admin:"Super Admin",admin:"Administrator",manager:"Manager",operator:"Operator",viewer:"Viewer"})[a]||a,O=a=>new Date(a).toLocaleDateString(),Q=a=>{console.log("View user:",a)},j=a=>{n.value={...a},t.value=!0},M=()=>{t.value=!1,n.value=null},T=async a=>{try{n.value?await U.put(`/admin-api/api/users/${n.value.id}/`,a):await U.post("/admin-api/api/users/",a),M(),_()}catch(r){console.error("Failed to save user:",r),alert("Failed to save user. Please try again.")}},H=async a=>{try{await U.post(`/admin-api/api/users/${a.id}/toggle_status/`),_()}catch(r){console.error("Failed to toggle user status:",r),alert("Failed to update user status.")}},J=async a=>{if(confirm(`Are you sure you want to reset the password for ${a.full_name||a.user.username}?`))try{await U.post(`/admin-api/api/users/${a.id}/reset_password/`),alert("Password reset successfully. A temporary password has been sent to the user.")}catch(r){console.error("Failed to reset password:",r),alert("Failed to reset password.")}},K=async a=>{if(a.role==="super_admin"){alert("Cannot delete super admin users.");return}if(confirm(`Are you sure you want to delete ${a.full_name||a.user.username}?`))try{await U.delete(`/admin-api/api/users/${a.id}/`),_()}catch(r){console.error("Failed to delete user:",r),alert("Failed to delete user. Please try again.")}},G=()=>{console.log("Exporting users...")};return N(()=>{_()}),{users:u,loading:o,searchQuery:g,roleFilter:s,statusFilter:b,currentPage:c,pageSize:l,totalUsers:y,showAddUserModal:t,editingUser:n,totalPages:h,visiblePages:I,debouncedSearch:q,applyFilters:R,changePage:z,formatRole:B,formatDate:O,viewUser:Q,editUser:j,closeUserModal:M,saveUser:T,toggleUserStatus:H,resetPassword:J,deleteUser:K,exportUsers:G}}},Me={class:"admin-users"},Se={class:"page-header"},xe={class:"header-content"},Ve=["disabled"],Ee={class:"filters-section"},De={class:"search-box"},Ne={class:"filter-controls"},Le={class:"table-container"},Ie={class:"table-header"},qe={class:"table-actions"},Re=["disabled"],ze={class:"table-wrapper"},Be={class:"data-table"},Oe={key:0},Qe={key:1},je={colspan:"7",class:"empty-row"},Te={class:"user-info"},He={class:"user-details"},Je={key:0,class:"custom-role"},Ke={class:"dept-info"},Ge={class:"date-info"},We={class:"login-count"},Xe={class:"action-buttons"},Ye=["onClick"],Ze=["onClick"],$e=["onClick","title"],eo=["onClick"],oo=["onClick","disabled"],so={key:0,class:"pagination-container"},to={class:"pagination-info"},lo={class:"pagination"},ao=["disabled"],no=["onClick"],ro=["disabled"];function io(u,o,g,s,b,c){const l=V("UserModal"),y=V("AdminLayout");return m(),x(y,null,{default:$(()=>[e("div",Me,[e("div",Se,[e("div",xe,[o[12]||(o[12]=e("div",null,[e("h1",null,"User Management"),e("p",null,"Manage admin users and their permissions")],-1)),e("button",{onClick:o[0]||(o[0]=t=>s.showAddUserModal=!0),class:"btn btn-primary",disabled:s.loading},[...o[11]||(o[11]=[e("i",{class:"icon-user-plus"},null,-1),C(" Add User ",-1)])],8,Ve)])]),e("div",Ee,[e("div",De,[o[13]||(o[13]=e("i",{class:"icon-search"},null,-1)),d(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.searchQuery=t),type:"text",placeholder:"Search users...",onInput:o[2]||(o[2]=(...t)=>s.debouncedSearch&&s.debouncedSearch(...t))},null,544),[[f,s.searchQuery]])]),e("div",Ne,[d(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>s.roleFilter=t),onChange:o[4]||(o[4]=(...t)=>s.applyFilters&&s.applyFilters(...t))},[...o[14]||(o[14]=[e("option",{value:""},"All Roles",-1),e("option",{value:"super_admin"},"Super Admin",-1),e("option",{value:"admin"},"Admin",-1),e("option",{value:"manager"},"Manager",-1),e("option",{value:"operator"},"Operator",-1),e("option",{value:"viewer"},"Viewer",-1)])],544),[[F,s.roleFilter]]),d(e("select",{"onUpdate:modelValue":o[5]||(o[5]=t=>s.statusFilter=t),onChange:o[6]||(o[6]=(...t)=>s.applyFilters&&s.applyFilters(...t))},[...o[15]||(o[15]=[e("option",{value:""},"All Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)])],544),[[F,s.statusFilter]])])]),e("div",Le,[e("div",Ie,[o[17]||(o[17]=e("h3",null,"Admin Users",-1)),e("div",qe,[e("button",{onClick:o[7]||(o[7]=(...t)=>s.exportUsers&&s.exportUsers(...t)),class:"btn btn-secondary btn-sm",disabled:s.loading||s.users.length===0},[...o[16]||(o[16]=[e("i",{class:"icon-download"},null,-1),C(" Export ",-1)])],8,Re)])]),e("div",ze,[e("table",Be,[o[26]||(o[26]=e("thead",null,[e("tr",null,[e("th",null,"User"),e("th",null,"Role"),e("th",null,"Department"),e("th",null,"Status"),e("th",null,"Last Login"),e("th",null,"Login Count"),e("th",null,"Actions")])],-1)),e("tbody",null,[s.loading?(m(),p("tr",Oe,[...o[18]||(o[18]=[e("td",{colspan:"7",class:"loading-row"},[e("div",{class:"loading-spinner"}),C(" Loading users... ")],-1)])])):s.users.length===0?(m(),p("tr",Qe,[e("td",je,[o[19]||(o[19]=e("i",{class:"icon-users"},null,-1)),o[20]||(o[20]=e("p",null,"No admin users found",-1)),e("button",{onClick:o[8]||(o[8]=t=>s.showAddUserModal=!0),class:"btn btn-primary btn-sm"}," Add First User ")])])):w("",!0),(m(!0),p(E,null,D(s.users,t=>(m(),p("tr",{key:t.id},[e("td",null,[e("div",Te,[o[21]||(o[21]=e("div",{class:"user-avatar"},[e("i",{class:"icon-user"})],-1)),e("div",null,[e("h4",null,i(t.full_name||t.user.username),1),e("div",He,[e("span",null,i(t.user.email),1),e("small",null,"ID: "+i(t.id),1)])])])]),e("td",null,[e("span",{class:k(["role-badge",`role-${t.role}`])},i(s.formatRole(t.role)),3),t.custom_role?(m(),p("div",Je,[e("small",null,i(t.custom_role.name),1)])):w("",!0)]),e("td",null,[e("div",Ke,i(t.department||"Not assigned"),1)]),e("td",null,[e("span",{class:k(["status-badge",t.is_active?"active":"inactive"])},i(t.is_active?"Active":"Inactive"),3)]),e("td",null,[e("div",Ge,i(t.last_login?s.formatDate(t.last_login):"Never"),1)]),e("td",null,[e("span",We,i(t.login_count||0),1)]),e("td",null,[e("div",Xe,[e("button",{onClick:n=>s.viewUser(t),class:"btn-icon",title:"View Details"},[...o[22]||(o[22]=[e("i",{class:"icon-eye"},null,-1)])],8,Ye),e("button",{onClick:n=>s.editUser(t),class:"btn-icon",title:"Edit User"},[...o[23]||(o[23]=[e("i",{class:"icon-edit"},null,-1)])],8,Ze),e("button",{onClick:n=>s.toggleUserStatus(t),class:k(["btn-icon",t.is_active?"text-warning":"text-success"]),title:t.is_active?"Deactivate":"Activate"},[e("i",{class:k(t.is_active?"icon-pause":"icon-play")},null,2)],10,$e),e("button",{onClick:n=>s.resetPassword(t),class:"btn-icon",title:"Reset Password"},[...o[24]||(o[24]=[e("i",{class:"icon-key"},null,-1)])],8,eo),e("button",{onClick:n=>s.deleteUser(t),class:"btn-icon text-danger",title:"Delete User",disabled:t.role==="super_admin"},[...o[25]||(o[25]=[e("i",{class:"icon-trash-2"},null,-1)])],8,oo)])])]))),128))])])]),s.totalPages>1?(m(),p("div",so,[e("div",to," Showing "+i((s.currentPage-1)*s.pageSize+1)+" to "+i(Math.min(s.currentPage*s.pageSize,s.totalUsers))+" of "+i(s.totalUsers)+" users ",1),e("div",lo,[e("button",{onClick:o[9]||(o[9]=t=>s.changePage(s.currentPage-1)),disabled:s.currentPage===1,class:"page-btn"},[...o[27]||(o[27]=[e("i",{class:"icon-chevron-left"},null,-1)])],8,ao),(m(!0),p(E,null,D(s.visiblePages,t=>(m(),p("button",{key:t,onClick:n=>s.changePage(t),class:k(["page-btn",{active:t===s.currentPage}])},i(t),11,no))),128)),e("button",{onClick:o[10]||(o[10]=t=>s.changePage(s.currentPage+1)),disabled:s.currentPage===s.totalPages,class:"page-btn"},[...o[28]||(o[28]=[e("i",{class:"icon-chevron-right"},null,-1)])],8,ro)])])):w("",!0)])]),s.showAddUserModal||s.editingUser?(m(),x(l,{key:0,user:s.editingUser,onClose:s.closeUserModal,onSave:s.saveUser},null,8,["user","onClose","onSave"])):w("",!0)]),_:1})}const fo=L(Fe,[["render",io],["__scopeId","data-v-07d7079f"]]);export{fo as default};
